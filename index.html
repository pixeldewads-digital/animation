<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Invoice Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-8">
        <div class="bg-white p-8 rounded-lg shadow-md">
            <h1 class="text-3xl font-bold mb-6 text-gray-800">Meta Invoice Generator</h1>
            <form id="invoice-form" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-4">
                <h2 class="text-lg font-semibold text-gray-700">Informasi Dasar</h2>
                <div>
                    <label for="account_id" class="block text-sm font-medium text-gray-700 mb-1">ID Akun</label>
                    <input id="account_id" name="account_id" type="text" placeholder="695566674863880" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>
                <div>
                    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                    <input id="date" name="date" type="datetime-local" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>
                <div>
                    <label for="payment_method" class="block text-sm font-medium text-gray-700 mb-1">Metode Pembayaran</label>
                    <select id="payment_method" name="payment_method" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="Kartu Kredit (Visa/Mastercard/Amex)">Kartu Kredit (Visa/Mastercard/Amex)</option>
                        <option value="Kartu Debit">Kartu Debit</option>
                        <option value="PayPal">PayPal</option>
                        <option value="Direct Debit (ACH/SEPA)">Direct Debit (ACH/SEPA)</option>
                        <option value="Bank Transfer / Manual Top-Up">Bank Transfer / Manual Top-Up</option>
                        <option value="Online Banking">Online Banking</option>
                        <option value="Facebook Ad Coupon / Credit">Facebook Ad Coupon / Credit</option>
                        <option value="Lainnya">Lainnyaâ€¦</option>
                    </select>
                    <input id="payment_method_other" type="text" placeholder="Metode lain (isi manual)" class="mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent hidden" />
                </div>
                <div>
                    <label for="transaction_id" class="block text-sm font-medium text-gray-700 mb-1">ID Transaksi</label>
                    <input id="transaction_id" name="transaction_id" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700" readonly />
                </div>
                <div>
                    <label for="product_type" class="block text-sm font-medium text-gray-700 mb-1">Jenis Produk</label>
                    <input id="product_type" name="product_type" type="text" value="Meta iklan" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>
            </div>
            <!-- Kanan -->
            <div class="space-y-4">
                <h2 class="text-lg font-semibold text-gray-700">Nilai & Status</h2>
                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                    <select id="status" name="status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option>Didanai</option>
                        <option>Tertunda</option>
                        <option>Dibatalkan</option>
                    </select>
                </div>
                <div>
                    <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Jumlah (contoh: Rp2.500.000)</label>
                    <input id="amount" name="amount" type="text" required placeholder="Rp2.500.000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Deskripsi</label>
                    <textarea id="description" name="description" rows="4" placeholder="Receipt for Kemilau Spa" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>
                <div>
                    <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Catatan (opsional)</label>
                    <input id="notes" name="notes" type="text" placeholder="Tidak ada alasan yang tersedia." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>
            </div>
            <div class="md:col-span-2">
                <button type="submit" id="submit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 shadow-md hover:shadow-lg">Tambah ke Daftar</button>
            </div>
        </form>
        </div>

        <div id="invoice-output" class="mt-8"></div>
    </div>

    <script>
        document.getElementById('payment_method').addEventListener('change', function() {
            const otherPaymentMethodInput = document.getElementById('payment_method_other');
            if (this.value === 'Lainnya') {
                otherPaymentMethodInput.classList.remove('hidden');
            } else {
                otherPaymentMethodInput.classList.add('hidden');
            }
        });

        document.getElementById('invoice-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const transactionId = 'txn_' + new Date().getTime();
            document.getElementById('transaction_id').value = transactionId;

            const formData = {
                accountId: document.getElementById('account_id').value,
                date: document.getElementById('date').value,
                paymentMethod: document.getElementById('payment_method').value === 'Lainnya' ? document.getElementById('payment_method_other').value : document.getElementById('payment_method').value,
                transactionId: transactionId,
                productType: document.getElementById('product_type').value,
                status: document.getElementById('status').value,
                amount: document.getElementById('amount').value,
                description: document.getElementById('description').value,
                notes: document.getElementById('notes').value
            };

            const invoiceOutput = document.getElementById('invoice-output');
            invoiceOutput.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-md mt-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-800">Invoice</h2>
                        <div class="text-2xl font-bold text-gray-700">Meta</div>
                    </div>
                    <div class="border-b-2 border-gray-200 pb-6 mb-6">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-600"><strong>Account ID:</strong> ${formData.accountId}</p>
                                <p class="text-gray-600"><strong>Date:</strong> ${formData.date}</p>
                                <p class="text-gray-600"><strong>Payment Method:</strong> ${formData.paymentMethod}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-gray-600"><strong>Transaction ID:</strong> ${formData.transactionId}</p>
                                <p class="text-gray-600"><strong>Product Type:</strong> ${formData.productType}</p>
                                <p class="text-gray-600"><strong>Status:</strong> <span class="font-semibold text-green-500">${formData.status}</span></p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="text-gray-600"><strong>Amount:</strong> <span class="text-xl font-bold text-gray-800">${formData.amount}</span></p>
                        <p class="text-gray-600 mt-2"><strong>Description:</strong> ${formData.description}</p>
                        <p class="text-gray-600 mt-2"><strong>Notes:</strong> ${formData.notes}</p>
                    </div>
                    <div class="mt-8 text-right">
                        <button id="download-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">Download PDF</button>
                    </div>
                </div>
            `;

            document.getElementById('download-btn').addEventListener('click', function() {
                const invoiceElement = invoiceOutput.querySelector('.bg-white');
                html2pdf().from(invoiceElement).save('invoice.pdf');
            });
        });
    </script>
    <script>
  // Pastikan file meta.svg ada di root atau sesuaikan path-nya
  const logoPath = './meta.svg';

  // Saat halaman dimuat, tampilkan logo di header
  window.addEventListener('DOMContentLoaded', async () => {
    const imgEl = document.querySelector('img[alt="Meta Logo"]');
    if (imgEl) {
      imgEl.src = logoPath;
    }
  });

  // Fungsi untuk memuat logo sebagai data URL (untuk PDF)
  async function getLogoBase64() {
    try {
      const res = await fetch(logoPath);
      const blob = await res.blob();
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(blob);
      });
    } catch (e) {
      console.error('Gagal memuat logo Meta:', e);
      return null;
    }
  }

  // Tambahkan ke fungsi exportToPDF
  async function exportToPDF(idx) {
    const r = store[idx];
    if (!window.jspdf) {
      showToast('jsPDF belum termuat', 'error');
      return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'pt', format: 'a4' });
    const pageW = doc.internal.pageSize.getWidth();
    const marginX = 56;
    let y = 64;

    // Tambahkan logo dari repo
    const logoData = await getLogoBase64();
    if (logoData) {
      doc.addImage(logoData, 'SVG', marginX, y - 20, 40, 40);
    }

    doc.setFont('helvetica', 'bold');
    doc.setFontSize(16);
    doc.text('Meta Platforms Ireland Limited', marginX + 50, y);

    // ...lanjutkan bagian PDF seperti biasa
  }
</script>
    <script>
  // Fungsi generate ID transaksi numerik penuh
  function genTxId() {
    const length = 16; // jumlah digit
    let id = '';
    for (let i = 0; i < length; i++) {
      id += Math.floor(Math.random() * 10);
    }
    return id;
  }

  // Auto-generate ID saat halaman dimuat
  window.addEventListener('DOMContentLoaded', () => {
    const txInput = document.getElementById('transaction_id');
    if (txInput) txInput.value = genTxId();

    // Regenerate setiap kali form disubmit
    document.getElementById('invoice-form').addEventListener('submit', () => {
      setTimeout(() => {
        txInput.value = genTxId();
      }, 100);
    });
  });
</script>

</body>
</html>
